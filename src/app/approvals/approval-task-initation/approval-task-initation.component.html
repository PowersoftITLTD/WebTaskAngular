<body class="layout layout-left-navigation layout-below-toolbar layout-below-footer">
  <main>
    <div id="wrapper">
      <div class="content-wrapper card">
        <div class="">
          <div id="e-commerce-product" class="simple tabbed">
            <app-header-bar (loggedInUserEmitter)="receiveLoggedInUser($event)"></app-header-bar>

            <div class="bg-primary text-auto row align-items-center justify-content-between p-3">

              <div class="row no-gutters align-items-center">
                <div class="product-image mr-4 ml-8">
                  <img src="../../../../assets/Content/images/ecommerce/product-image-placeholder.png">
                </div>
                <div>
                  <b>Approval Task Initiation</b>
                </div>
              </div>

              <div class="flex-grow-1"></div>

              <div *ngIf="taskData?.MKEY">
                <button type="submit" class="btn btn-light mr-6" (click)="onAddInitiation()" id="btnSaveTask">
                  SAVE
                </button>
              </div>

            </div>
            <form [formGroup]="appeInitForm" (ngSubmit)="onSubmit()">
              <div class="tab-content">
                <div class="p-3">

                  <div class="row">
                    <div class="col-xs-12 col-xl-4 col-md-12">
                      <div class="form-group">
                        <label for="taskName">Property</label>

                        <ng-container *ngIf="taskData?.MKEY">
                          <select class="form-control" formControlName="property" #projectSelect [class.disabled]="true"
                            [attr.disabled]="true" [disabled]="isFieldDisabled"
                            (change)="onProjectSelect(projectSelect)">
                            <option value="0">Select</option>
                            <option *ngFor="let p of project" [ngValue]="p"
                              [selected]="p.TYPE_DESC === taskData.project_Name">
                              {{ p.TYPE_DESC }}
                            </option>
                          </select>
                        </ng-container>


                        <ng-container *ngIf="!taskData?.MKEY">
                          <select class="form-control " formControlName="property" #projectSelect
                            (change)="onProjectSelect(projectSelect)">
                            <option value="0" selected>Select</option>
                            <option *ngFor="let p of project" [ngValue]="p">{{ p.TYPE_DESC }}</option>
                          </select>
                        </ng-container>

                      </div>
                    </div>
                    <div class="col-xs-12 col-xl-4 col-md-12">
                      <div class="form-group">
                        <label for="category">Building</label>

                        <div class="">

                          <!-- First container (input), displayed when taskData?.MKEY is truthy -->
                          <div class="input">
                            <select class="form-control" [class.disabled]="true" [attr.disabled]="true"
                              [disabled]="isFieldDisabled">
                              <option value="0">Select</option>
                              <option *ngFor="let s of sub_proj" [ngValue]="s"
                                [selected]="s.TYPE_DESC === taskData.sub_proj_name">
                                {{ s.TYPE_DESC }}
                              </option>
                            </select>
                          </div>

                          <!-- Second container (select), displayed when taskData?.MKEY is falsy -->
                          <!-- <div class="select">
                            <select class="form-control" formControlName="building">
                              <option value="0">Select</option>
                              <option *ngFor="let s of sub_proj" [ngValue]="s">
                                {{ s.TYPE_DESC }}
                              </option>
                            </select>
                          </div> -->
                        </div>




                      </div>
                    </div>
                    <div class="col-xs-12 col-xl-4 col-md-12">
                      <div class="form-group">
                        <label for="taskName">Initiator&nbsp;<small>*</small></label>
                        <input type="text" formControlName="initiator" maxlength="150" (input)="filterEmployeesInitiator($event)"
                          [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                          class="form-control" maxlength="150" />
                      </div>
                      <div style="width: 100%;" class="pr-10 mt-1">
                        <ul>
                          <li *ngFor="let event of filteredInitiator; let i = index;" class="active" type="button"
                            [class.inactive]="filteredInitiator" (click)="selectInitiatoe(event);">
                            {{ event.Assign_to }}
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>

                  <div class="row ">
                    <div class="col-xs-12 col-xl-4 col-md-12 ">
                      <div class="form-group">

                        <label for="taskName">Task Abbrivation / Serial No.</label>

                        <ng-container *ngIf="taskData?.MKEY">
                          <input type="text" maxlength="150" formControlName="abbrivation" [disabled]="isFieldDisabled"
                            [(ngModel)]="taskData.MAIN_ABBR" class="form-control"
                            [ngStyle]="isFieldDisabled ? { 'background-color': '#e0e0e0', 'color': '#a1a1a1', 'cursor': 'not-allowed' } : {}"
                            maxlength="150" />
                        </ng-container>

                        <ng-container *ngIf="!taskData?.MKEY">
                          <input type="text" maxlength="150" formControlName="abbrivation" class="form-control"
                            maxlength="150" />
                        </ng-container>

                      </div>

                      <div class="form-group">

                        <ng-container *ngIf="taskData.MKEY">
                          <label for="taskName">Task Short Description <small>*</small></label>
                          <input type="text" maxlength="150" formControlName="shortDescription"
                            [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                            [(ngModel)]="taskData.SHORT_DESCRIPTION" class="form-control" maxlength="150" />
                        </ng-container>

                        <ng-container *ngIf="!taskData.MKEY">
                          <label for="taskName">Task Short Description<small>*</small></label>
                          <input type="text" maxlength="150" formControlName="shortDescription" class="form-control"
                            maxlength="150" />
                        </ng-container>

                      </div>
                    </div>
                    <div class="col-xs-12 col-xl-8 col-md-12 mt-1">
                      <div class="form-group">
                        <label for="taskName">Task Description&nbsp;<small>*</small></label>
                        <ng-container *ngIf="taskData.MKEY">
                          <textarea type="text" formControlName="longDescriotion"
                            [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                            [(ngModel)]="taskData.LONG_DESCRIPTION" class="form-control" style="height: 12rem;" rows="5"
                            maxlength="150"> </textarea>
                        </ng-container>

                        <ng-container *ngIf="!taskData.MKEY">
                          <textarea type="text" formControlName="longDescriotion" class="form-control"
                            style="height: 12rem;" rows="5" maxlength="150"> </textarea>
                        </ng-container>

                      </div>
                    </div>
                  </div>

                  <div class="row">
                    <!-- <div class="col-xs-12 col-xl-3 col-md-12 ">
                      <div class="form-group">
                        <label for="category">Sanctioning Authority</label>

                          <select class="form-control" [class.disabled]="true"
                          [attr.disabled]="true" [disabled]="isFieldDisabled">
                            <option value="">--SELECT--</option>
                            <option *ngFor="let sanctioningAuth of SanctoningAuthList" 
                                    [value]="sanctioningAuth.mkey" 
                                    [selected]="sanctioningAuth.typE_DESC === taskData.SANCTION_AUTHORITY_NAME">
                              {{ sanctioningAuth.typE_DESC }}
                            </option>
                          </select>
                                               
                      </div>
                    </div> -->
                    <!-- <div class="col-xs-12 col-xl-3 col-md-12 ">

                      <div class="form-group">

                        <ng-container *ngIf="taskData.MKEY">
                          <label for="taskName">Sanctioning Department</label>
                          <input type="text" maxlength="150" formControlName="sanctioningDepartment"
                            [ngStyle]="isFieldDisabled ? { 'background-color': '#e0e0e0', 'color': '#a1a1a1', 'cursor': 'not-allowed' } : {}"
                            [(ngModel)]="taskData.SANCTION_DEPARTMENT" class="form-control" maxlength="150" />
                        </ng-container>

                        <ng-container *ngIf="!taskData.MKEY">
                          <label for="taskName">Sanctioning Department</label>
                          <input type="text" maxlength="150" formControlName="sanctioningDepartment"
                            class="form-control" maxlength="150" />
                        </ng-container>
                      </div>
                    </div> -->

                   

                    <!-- <div class="col-xs-12 col-xl-3 col-md-12">
                      <div class="form-group">
                        <label for="taskName">Start Date&nbsp;<small>*</small></label>
                        <input type="date"
                          [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                          formControlName="startDate" [min]="currentDate" maxlength="150" class="form-control" maxlength="150" />
                      </div>
                    </div>

                    <div class="col-xs-12 col-xl-3 col-md-12">
                      <div class="form-group">
                        <label for="taskName">End Date&nbsp;<small>*</small></label>
                        <input type="date"
                          [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                          formControlName="endDate" [min]="currentDate" maxlength="150" class="form-control" maxlength="150" />
                      </div>
                    </div> -->
                  </div>

                  <div class="row">

                    <div class="col-xs-12 col-xl-4 col-md-12">
                      <div class="form-group">
                        <label for="category">Responsible Person&nbsp;<small>*</small></label>

                        <ng-container *ngIf="taskData?.MKEY">
                          <input type="text" class="form-control" [(ngModel)]="taskData.emp_name" formControlName="responsiblePerson"
                            (input)="filterEmployees($event)" appAlphabeticOnly
                            [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}" />
                        </ng-container>

                        <ng-container *ngIf="!taskData?.MKEY">
                          <input type="text" class="form-control" formControlName="responsiblePerson"
                            (input)="filterEmployees($event)" appAlphabeticOnly />
                        </ng-container>

                        <div style="width: 100%;" class="pr-10 mt-1">
                          <ul>
                            <li *ngFor="let event of filteredEmployees; let i = index;" class="active" type="button"
                              [class.inactive]="filteredEmployees" (click)="selectEmployee(event);">
                              {{ event.Assign_to }}
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>

                    <div class="col-xs-12 col-xl-4 col-md-12">
                      <div class="form-group">
                        <label for="category">Job Role</label>
                        <select class="h6 form-control" [class.disabled]="true"
                          [attr.disabled]="true" [disabled]="isFieldDisabled">
                          <option value="">--SELECT--</option>
                          <option *ngFor="let jobRole of jobRoleList" [value]="jobRole.mkey"
                            [selected]="jobRole.typE_DESC === taskData.JOB_ROLE_NAME">{{jobRole.typE_DESC}}</option>
                        </select>
                      </div>
                    </div>

                    <div class="col-xs-12 col-xl-4 col-md-12">
                      <div class="form-group">
                        <label for="category">Departrment</label>
                        <select class="h6 form-control" [class.disabled]="true" [attr.disabled]="true"
                          [disabled]="isFieldDisabled">
                          <option value=""> --SELECT--</option>
                          <option *ngFor="let dept of departmentList" [value]="dept.mkey"
                            [selected]="dept.typE_DESC === taskData.AUTHORITY_DEPARTMENT_NAME">{{dept.typE_DESC}}
                          </option>
                        </select>
                      </div>
                    </div>

              
                   <div class="col-xs-12 col-xl-4 col-md-12">
                    <div class="form-group">
                      <label for="taskName">Start Date&nbsp;<small>*</small></label>
                      <input type="date"
                        [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                        formControlName="startDate" [min]="currentDate" maxlength="150" class="form-control" (change)="calculateHeaderDate($event)"  maxlength="150" />
                    </div>
                  </div>

                  <div class="col-xs-12 col-xl-4 col-md-12">
                    <div class="form-group">
                      <label for="taskName">End Date&nbsp;<small>*</small></label>
                      <input type="date"
                        [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                        formControlName="endDate" [min]="currentDate" maxlength="150" class="form-control" maxlength="150" />
                    </div>
                  </div>

                   <div class="col-xs-12 col-xl-4 col-md-12">
                    <div class="form-group">
                      <label for="taskName">Complition Date&nbsp;<small>*</small></label>
                      <input type="date"
                        [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                        formControlName="complitionDate" [min]="currentDate" maxlength="150" class="form-control" maxlength="150" />
                    </div>
                  </div>

                  <div class="col-xs-12 col-xl-12 col-md-12">
                    <div class="form-group">
                      <label for="tags">Tags</label>
                        <tag-input [addOnBlur]="true"
                            [formControl]="appeInitForm.get('tags')">
                            <tag-input-dropdown [autocompleteItems]="allTags"
                                [showDropdownIfEmpty]="true"
                                [dynamicUpdate]="true"></tag-input-dropdown>
                        </tag-input>
                  </div>
                  </div>

                  <br>
                  <br>
                  <br>
                  <br>
                  <br>
                  <!-- <div class="sample-wrapper">
                    <table class="table">
                        <thead>
                            <tr>
                                <th>Sr no.</th>
                                <th>Level</th>
                                <th>Sanctioning Department</th>
                                <th>Sanctioning Authority</th>
                                <th>Start Date</th>
                                <th>
                                    <div class="end-date-container">
                                        <div class="end-date-text">End Date (Optional)</div>
                                        <i class="fa-solid fa-plus btn" type="button" (click)="addRowNew()"></i>
                                    </div>
                                </th>                                                                                                                              
                             
                            </tr>
                        </thead>
                        <tbody formArrayName="rows_new">
                            <ng-container >
                                <tr *ngFor="let row of appeInitForm.get('rows_new').controls; let i = index" [formGroupName]="i">
                                    <td>
                                        <div class="mt-1 ml-2">
                                            {{ i + 1 }}
                                        </div>
                                    </td>
                                    <td style="width:10rem">
                                        <input class="form-control"  formControlName="level" type="number"  />
                                    </td>                                                                     
                               
                                    <td>
                                        <input class="form-control" formControlName="sanctioningDept" type="text"  />
                                    </td>  
                                    <td>          
                                        <select class="h6 form-control" formControlName="sanctioningAuth">
                                        <option value=""> --SELECT--</option>
                                        <option *ngFor="let sanctioningAuth of SanctoningAuthList"
                                            [value]="sanctioningAuth.mkey">
                                            {{sanctioningAuth.typE_DESC}} </option>
                                        </select>                                                                                                                               
                                    </td>                                                                                                                              
                                    <td style="width:20rem">
                                        <input class="form-control" formControlName="startDate_newRow" [min]="currentDate"  type="date" />  
                                    </td>
                                    <td style="width:20rem">
                                        <input class="form-control" formControlName="endDate_newRow" [min]="currentDate"  type="date"  />
                                    </td>                                                                 
                           
                                </tr>
                            </ng-container>
                        </tbody>
                    </table>                 
                 </div> -->
                  


                  </div>
                </div>

                <div class="accordion">
                  <div *ngFor="let item of accordionItems; let i = index" class="accordion-item">

                    <h2 class="accordion-header">
                      <button (click)="toggle(i)" class="accordion-button" type="button">
                        {{ item.title }}
                      </button>
                    </h2>

                    <div class="accordion-body" [class.show]="activeIndices.includes(i)">
                      <!--[class.show]="activeIndices.includes(i)"-->
              
                        <div class="mb-3" *ngIf="i === 0">

                          <!-- For accordion 2 -->
                          <div *ngIf="!loading" class="progress-details">
                            <div class="table-scroll-container mx-2">
                              <table class="table table-active">

                                <thead class="table-header">
                                  <tr>
                                    <th><i class="fas fa-edit"></i></th>
                                    <th>Sr No</th>
                                    <th>Abbrivation</th>
                                    <th class="truncate-date">Approved Description</th>
                                    <th class="truncate-date">Short Description</th>
                                    <th>Days Required</th>
                                    <th>Department</th>
                                    <th>Job Role</th>
                                    <th>Responsible Person</th>
                                    <th>Output Document</th>
                                    <th>Tentative Start Date</th>
                                    <th>Tentative End Date</th>
                                    <th>Status</th>
                                  </tr>
                                </thead>

                                <tbody>
                                  <ng-template #recursiveTaskTemplate let-tasks>
                                    <ng-container *ngFor="let task of tasks">
                                      <tr [ngClass]="{'highlight': formVisibleMap[task.TASK_NO.TASK_NO]}">
                                        <td>
                                          <div class="d-flex justify-content-end  mr-3">
                                            <i class="fa fa-pencil" style="font-size:15px" type="button"
                                              (click)="toggleFormVisibility_main(task.TASK_NO.TASK_NO, task)"></i>
                                          </div>
                                        </td>
                                        <td style="min-width: 300px;">

                                          <ng-container *ngIf="task.TASK_NO.TASK_NO">
                                            <span
                                              [style.marginLeft.px]="calculateIndentation(task.TASK_NO.TASK_NO, task.subtask && task.subtask.length > 0 ? 15 : 30)">
                                              <mat-icon *ngIf="task.subtask && task.subtask.length > 0"
                                                (click)="toggleVisibility(task)" style="cursor: pointer;">
                                                <img
                                                  src="../../../../assets/Content/images/{{ task.visible ? 'collapse.png' : 'expand.png' }}">
                                              </mat-icon>
                                              {{ task.TASK_NO.TASK_NO }}
                                            </span>
                                          </ng-container>
                                        </td>
                                        <td class="truncate-text" matTooltip="{{ task.TASK_NO?.maiN_ABBR }}">{{ task.TASK_NO?.maiN_ABBR }}</td>
                                        <td class="truncate-text" matTooltip="{{ task.TASK_NO?.abbr_short_DESC }}">{{ task.TASK_NO?.abbr_short_DESC }}</td>
                                        <td class="truncate-text" matTooltip="{{ task.TASK_NO?.abbR_SHORT_DESC }}">{{ task.TASK_NO?.abbR_SHORT_DESC }}</td>
                                        <td class="truncate-text" matTooltip="{{ task.TASK_NO?.dayS_REQUIERD }}">{{ task.TASK_NO?.dayS_REQUIERD }}</td>
                                        <td class="truncate-text" matTooltip="{{ task.TASK_NO?.department }}">{{ task.TASK_NO?.department }}</td>
                                        <td class="truncate-text" matTooltip="{{ task.TASK_NO?.joB_ROLE }}">{{ task.TASK_NO?.joB_ROLE }}</td>
                                        <!-- <td class="truncate-text">{{ task.TASK_NO?.Responsible_Person }}</td> -->
                                        <td class="truncate-text" matTooltip="{{ task.TASK_NO?.RESPOSIBLE_EMP_NAME }}">{{ task.TASK_NO?.RESPOSIBLE_EMP_NAME }}</td>
  
                                        <td class="truncate-text" matTooltip="{{ task.TASK_NO?.enD_RESULT_DOC }}">{{ task.TASK_NO?.enD_RESULT_DOC }}</td>

                                        <td>
                                          <input type="date" class="form-control"
                                            (ngModelChange)="task.TASK_NO.start_date = $event"
                                            [ngModel]="task.TASK_NO.start_date | date: 'yyyy-MM-dd'"
                                            [ngModelOptions]="{standalone: true}" name="staDate_new_{{task.TASK_NO}}" />
                                        </td>

                                        <td>
                                          <input type="date" class="form-control"
                                            (ngModelChange)="task.TASK_NO.end_date = $event"
                                            [ngModel]="task.TASK_NO.end_date | date: 'yyyy-MM-dd'"
                                            [ngModelOptions]="{standalone: true}" name="endDate_new" />
                                        </td>

                                        <td class="truncate-text">{{ task.TASK_NO?.status }}</td>
                                      </tr>
                                      <tr *ngIf="formVisibleMap[task.TASK_NO.TASK_NO]">
                                        <td colspan="12">
                                          <form > <!--[formGroup]="subTaskForm" (ngSubmit)="onSubmitSubList(subTaskForm, task)"-->
                                            <div class="">
                                              <div class="classification-border" style="margin-right:50rem">
  
                                                <div class="row pl-3">
  
                                                  <div class="col-xs-12 col-xl-3 col-md-12">
                                                    <div class="form-group d-flex justify-content-between">
                                                      <label class="abbr-label" for="abbreviation">Abbreviation</label>
                                                      <input  type="text" class="abbr-input form-control" maxlength="150"
                                                        [value]="task.TASK_NO?.maiN_ABBR" [class.disabled]="true"
                                                        [attr.disabled]="true" [disabled]="isFieldDisabled" />
                                                    </div>
  
                                                    <div class="form-group d-flex justify-content-between">
                                                      <label class="abbr-label" for="abbreviation">Start
                                                        Date</label>
                                                      <input type="date" class="form-control"
                                                        
                                                        [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                                                        (ngModelChange)="task.TASK_NO.start_date = $event"
                                                        [ngModel]="task.TASK_NO.start_date | date: 'yyyy-MM-dd'"                                                        
                                                        name="staDate_new_{{task.TASK_NO}}" />
  
                                                    </div>
                                                  </div>
  
                                                  <div class="col-xs-12 col-xl-3 col-md-12">
                                                    <div class="form-group d-flex justify-content-between">
                                                      <label class="days-label" for="taskName">Short Description</label>
                                                      <input
                                                      [ngModelOptions]="{standalone: true}" (ngModelChange)="task.TASK_NO.abbr_short_DESC = $event" [ngModel]="task.TASK_NO?.abbr_short_DESC" 
                                                        [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                                                        type="text" class="abbr-input form-control" maxlength="150" />
                                                    </div>
  
  
                                                    <div class="form-group d-flex justify-content-between">
                                                      <label class="abbr-label" for="abbreviation">End
                                                        Date</label>
                                                      <input type="date" class="form-control"
                                                        
                                                        [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                                                        (ngModelChange)="task.TASK_NO.end_date = $event"
                                                        [ngModel]="task.TASK_NO.end_date | date: 'yyyy-MM-dd'"
                                                         name="endDate_new" />
                                                    </div>
                                                  </div>
  
                                                  <div class="col-xs-12 col-xl-6 col-md-12">
  
                                                    <div class="form-group d-flex justify-content-between">
                                                      <label class="abbr-label" for="abbreviation">Long
                                                        Description</label>
                                                      <textarea class="form-control" style="height: 2rem;"                                                    
                                                        [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"                                                      
                                                        rows="4" [ngModelOptions]="{standalone: true}" (ngModelChange)="task.TASK_NO.abbR_SHORT_DESC = $event" [ngModel]="task.TASK_NO?.abbR_SHORT_DESC"></textarea>
                                                    </div>
                                                  </div>
  
                                                </div>
  
                                                <div class="row pl-3">
  
                                                  <div class="col-xs-12 col-xl-3 col-md-12">
                                                    <div class="form-group d-flex justify-content-between">
                                                      <label class="abbr-label" for="abbreviation">Responsible
                                                        Person</label>
                                                      <input type="text" class="abbr-input form-control"                                                       
                                                        [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                                                        maxlength="150" [(ngModel)]="selectedAssignTo" placeholder="{{task.TASK_NO?.RESPOSIBLE_EMP_NAME}}"  [ngModelOptions]="{standalone: true}"  (input)="SubfilterEmployeesInitiator($event, task.TASK_NO?.TASK_NO)" />
                                                        <div style="width: 100%;" class="pr-10 mt-1">
                                                          <ul>
                                                            <li *ngFor="let event of subListFilteredEmp; let i = index;" class="active" type="button"
                                                              [class.inactive]="subListFilteredEmp" (click)="selectEmpSubList(event);">
                                                              {{ event.Assign_to }}
                                                            </li>
                                                          </ul>
                                                       </div>
                                                     </div>
                                                   </div>
  
  
                                                  <div class="col-xs-12 col-xl-3 col-md-12">
                                                    <div class="form-group d-flex justify-content-between">
                                                      <label class="dept-label" for="department">Departrment</label>
                                                      <select class="dept-select form-control" [class.disabled]="true"                                                      
                                                        [attr.disabled]="true" [disabled]="isFieldDisabled">
                                                        <option value=""> --SELECT--</option>
                                                        <option *ngFor="let dept of departmentList" [value]="dept.mkey"
                                                          [selected]="dept.typE_DESC === task.TASK_NO?.department">
                                                          {{dept.typE_DESC}}
                                                        </option>
                                                      </select>
                                                    </div>
                                                  </div>
  
                                                  <div class="col-xs-12 col-xl-3 col-md-12">
                                                    <div class="form-group d-flex justify-content-between">
                                                      <label class="jobrole-label" for="jobRole">Job Role</label>
                                                      <select class="dept-select form-control" [class.disabled]="true"                                                     
                                                        [attr.disabled]="true" [disabled]="isFieldDisabled">
                                                        <option value=""> --SELECT--</option>
                                                        <option *ngFor="let jobRole of jobRoleList"
                                                          [value]="jobRole.mkey"
                                                          [selected]="jobRole.typE_DESC === task.TASK_NO?.joB_ROLE">
                                                          {{ jobRole.typE_DESC }}
                                                        </option>
                                                      </select>
                                                    </div>
                                                  </div>
  
                                                  <div class="col-xs-12 col-xl-3 col-md-12">
                                                    <div class="form-group d-flex justify-content-between">
                                                      <label class="days-label" for="taskName">Output Document</label>
                                                      <input type="text" [value]="task.TASK_NO?.enD_RESULT_DOC"  
                                                        [class.disabled]="true" [attr.disabled]="true"
                                                        [disabled]="isFieldDisabled" class="days-input form-control"
                                                        maxlength="150" />
                                                    </div>
                                                  </div> 
                                                  
                                                  <div class="col-xs-12 col-xl-12 col-md-8">
                                                    <div class="form-group">
                                                        <label class="tags-label" for="tags">Tags</label>
                                                          <tag-input [addOnBlur]="true"
                                                          [(ngModel)]="selectedTags" 
                                                          [ngModelOptions]="{standalone: true}"
                                                              >
                                                              <tag-input-dropdown [autocompleteItems]="allTags"
                                                                  [showDropdownIfEmpty]="true"
                                                                  [dynamicUpdate]="true"></tag-input-dropdown>
                                                          </tag-input>
                                                    </div>
                                                 </div>
  
                                                 <!-- <div class="col-xs-12 col-xl-4 col-md-8">
                                                  <div class="form-group d-flex justify-content-between">
                                                    <label class="abbr-label" for="abbreviation">Complition
                                                      Date</label>
                                                    <input type="date" class="form-control"                                                                                                       
                                                      [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"                                                  
                                                      name="endDate_new" />
                                                  </div>
                                                </div> -->
                                                </div>
                                                <div class="row mt-2 justify-content-center">
                                                  <div class="col-xs-2">
                                                    <div class="btn btn-info d-flex justify-content-center" (click)="updatedTaskCheck(task.TASK_NO, selectedAssignTo)">Update
                                                    </div>
                                                  </div>
                                                  <div class="col-xs-2">
                                                    <div class="btn btn-light d-flex justify-content-center" (click)="toggleFormVisibility_main(task.TASK_NO.TASK_NO, task)">Cancel
                                                    </div>
                                                  </div>                                                 
                                                </div>
  
                                              </div>
                                            </div>
  
                                          </form>
                                        </td>
                                      </tr>
                                      <ng-container *ngIf="task.visible && task.subtask && task.subtask.length > 0">
                                        <ng-container
                                          *ngTemplateOutlet="recursiveTaskTemplate; context: { $implicit: task.subtask }"></ng-container>
                                      </ng-container>
                                    </ng-container>
                                  </ng-template>

                                  <ng-container *ngFor="let task of subTasks; trackBy: trackByTaskNo">
                                    <tr [ngClass]="{'highlight': formVisibleMap[task.TASK_NO.TASK_NO]}">
                                      <td>
                                        <div class="d-flex justify-content-end  mr-3">
                                          <i class="fa fa-pencil" style="font-size:15px" type="button"
                                            (click)="toggleFormVisibility_main(task.TASK_NO.TASK_NO, task)"></i>
                                        </div>
                                      </td>
                                      <td style="width: 300px;">
                                        <ng-container *ngIf="task.TASK_NO.TASK_NO">
                                          <span
                                            [style.marginLeft.px]="calculateIndentation(task.TASK_NO.TASK_NO, task.subtask && task.subtask.length > 0 ? 20 : 17)">
                                            <mat-icon *ngIf="task.subtask && task.subtask.length > 0"
                                              (click)="toggleVisibility(task)" style="cursor: pointer;">
                                              <img
                                                src="../../../../assets/Content/images/{{ task.visible ? 'collapse.png' : 'expand.png' }}">
                                            </mat-icon>
                                            {{ task.TASK_NO.TASK_NO }}
                                          </span>
                                        </ng-container>
                                      </td>
                                      <td class="truncate-text" matTooltip="{{ task.TASK_NO?.maiN_ABBR }}">{{ task.TASK_NO?.maiN_ABBR }}</td>
                                      <td class="truncate-text" matTooltip="{{ task.TASK_NO?.abbr_short_DESC }}">{{ task.TASK_NO?.abbr_short_DESC }}</td>
                                      <td class="truncate-text" matTooltip="{{ task.TASK_NO?.abbR_SHORT_DESC }}">{{ task.TASK_NO?.abbR_SHORT_DESC }}</td>
                                      <td class="truncate-text" matTooltip="{{ task.TASK_NO?.dayS_REQUIERD }}">{{ task.TASK_NO?.dayS_REQUIERD }}</td>
                                      <td class="truncate-text" matTooltip="{{ task.TASK_NO?.department }}">{{ task.TASK_NO?.department }}</td>
                                      <td class="truncate-text" matTooltip="{{ task.TASK_NO?.joB_ROLE }}">{{ task.TASK_NO?.joB_ROLE }}</td>
                                      <!-- <td class="truncate-text">{{ task.TASK_NO?.Responsible_Person }}</td> -->
                                      <td class="truncate-text" matTooltip="{{ task.TASK_NO?.RESPOSIBLE_EMP_NAME }}">{{ task.TASK_NO?.RESPOSIBLE_EMP_NAME }}</td>

                                      <td class="truncate-text" matTooltip="{{ task.TASK_NO?.enD_RESULT_DOC }}">{{ task.TASK_NO?.enD_RESULT_DOC }}</td>
                                      <!-- <td class="truncate-text">{{ task.TASK_NO?.STATUS }}</td> -->

                                      <td>
                                        <input type="date" class="form-control"
                                          (ngModelChange)="task.TASK_NO.start_date = $event"
                                          [ngModel]="task.TASK_NO.start_date | date: 'yyyy-MM-dd'"
                                          [ngModelOptions]="{standalone: true}" name="staDate_new_{{task.TASK_NO}}" />
                                      </td>

                                      <td>
                                        <input type="date" class="form-control"
                                          (ngModelChange)="task.TASK_NO.end_date = $event"
                                          [ngModel]="task.TASK_NO.end_date | date: 'yyyy-MM-dd'"
                                          [ngModelOptions]="{standalone: true}" name="endDate_new" />
                                      </td>

                                      <td class="truncate-text">{{ task.TASK_NO?.status }}</td>
                                    </tr>
                                    <tr *ngIf="formVisibleMap[task.TASK_NO.TASK_NO]">
                                      <td colspan="12">
                                        <form > <!--[formGroup]="subTaskForm" (ngSubmit)="onSubmitSubList(subTaskForm, task)"-->
                                          <div class="">
                                            <div class="classification-border" style="margin-right:50rem">

                                              <div class="row pl-3">

                                                <div class="col-xs-12 col-xl-3 col-md-12">
                                                  <div class="form-group d-flex justify-content-between">
                                                    <label class="abbr-label" for="abbreviation">Abbreviation</label>
                                                    <input  type="text" class="abbr-input form-control" maxlength="150"
                                                      [value]="task.TASK_NO?.maiN_ABBR" [class.disabled]="true"
                                                      [attr.disabled]="true" [disabled]="isFieldDisabled" />
                                                  </div>

                                                  <div class="form-group d-flex justify-content-between">
                                                    <label class="abbr-label" for="abbreviation">Start
                                                      Date</label>
                                                    <input type="date" class="form-control"
                                                      
                                                      [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                                                      (ngModelChange)="task.TASK_NO.start_date = $event"
                                                      [ngModel]="task.TASK_NO.start_date | date: 'yyyy-MM-dd'"                                                        
                                                      name="staDate_new_{{task.TASK_NO}}" />

                                                  </div>
                                                </div>

                                                <div class="col-xs-12 col-xl-3 col-md-12">
                                                  <div class="form-group d-flex justify-content-between">
                                                    <label class="days-label" for="taskName">Short Description</label>
                                                    <input
                                                    [ngModelOptions]="{standalone: true}" (ngModelChange)="task.TASK_NO.abbr_short_DESC = $event" [ngModel]="task.TASK_NO?.abbr_short_DESC" 
                                                      [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                                                      type="text" class="abbr-input form-control" maxlength="150" />
                                                  </div>


                                                  <div class="form-group d-flex justify-content-between">
                                                    <label class="abbr-label" for="abbreviation">End
                                                      Date</label>
                                                    <input type="date" class="form-control"
                                                      
                                                      [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                                                      (ngModelChange)="task.TASK_NO.end_date = $event"
                                                      [ngModel]="task.TASK_NO.end_date | date: 'yyyy-MM-dd'"
                                                       name="endDate_new" />
                                                  </div>
                                                </div>

                                                <div class="col-xs-12 col-xl-6 col-md-12">

                                                  <div class="form-group d-flex justify-content-between">
                                                    <label class="abbr-label" for="abbreviation">Long
                                                      Description</label>
                                                    <textarea class="form-control" style="height: 2rem;"                                                    
                                                      [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"                                                      
                                                      rows="4" [ngModelOptions]="{standalone: true}" (ngModelChange)="task.TASK_NO.abbR_SHORT_DESC = $event" [ngModel]="task.TASK_NO?.abbR_SHORT_DESC"></textarea>
                                                  </div>
                                                </div>

                                              </div>

                                              <div class="row pl-3">
                                                <div class="col-xs-12 col-xl-3 col-md-12">
                                                  <div class="form-group d-flex justify-content-between">
                                                    <label class="abbr-label" for="abbreviation">Responsible
                                                      Person</label>
                                                    <input type="text" class="abbr-input form-control"
                                                     
                                                      [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"
                                                      maxlength="150" [(ngModel)]="selectedAssignTo" placeholder="{{task.TASK_NO?.RESPOSIBLE_EMP_NAME}}" [ngModelOptions]="{standalone: true}"  (input)="SubfilterEmployeesInitiator($event, task.TASK_NO?.TASK_NO)" />
                                                      <div style="width: 100%;" class="pr-10 mt-1">
                                                        <ul>
                                                          <li *ngFor="let event of subListFilteredEmp; let i = index;" class="active" type="button"
                                                            [class.inactive]="subListFilteredEmp" (click)="selectEmpSubList(event);">
                                                            {{ event.Assign_to }}
                                                          </li>
                                                        </ul>
                                                      </div>
                                                  </div>
                                                </div>


                                                <div class="col-xs-12 col-xl-3 col-md-12">
                                                  <div class="form-group d-flex justify-content-between">
                                                    <label class="dept-label" for="department">Departrment</label>
                                                    <select class="dept-select form-control" [class.disabled]="true"                                                      
                                                      [attr.disabled]="true" [disabled]="isFieldDisabled">
                                                      <option value=""> --SELECT--</option>
                                                      <option *ngFor="let dept of departmentList" [value]="dept.mkey"
                                                        [selected]="dept.typE_DESC === task.TASK_NO?.department">
                                                        {{dept.typE_DESC}}
                                                      </option>
                                                    </select>
                                                  </div>
                                                </div>

                                                <div class="col-xs-12 col-xl-3 col-md-12">
                                                  <div class="form-group d-flex justify-content-between">
                                                    <label class="jobrole-label" for="jobRole">Job Role</label>
                                                    <select class="dept-select form-control" [class.disabled]="true"                                                     
                                                      [attr.disabled]="true" [disabled]="isFieldDisabled">
                                                      <option value=""> --SELECT--</option>
                                                      <option *ngFor="let jobRole of jobRoleList"
                                                        [value]="jobRole.mkey"
                                                        [selected]="jobRole.typE_DESC === task.TASK_NO?.joB_ROLE">
                                                        {{ jobRole.typE_DESC }}
                                                      </option>
                                                    </select>
                                                  </div>
                                                </div>

                                                <div class="col-xs-12 col-xl-3 col-md-12">
                                                  <div class="form-group d-flex justify-content-between">
                                                    <label class="days-label" for="taskName">Output Document</label>
                                                    <input type="text" [value]="task.TASK_NO?.enD_RESULT_DOC"  
                                                      [class.disabled]="true" [attr.disabled]="true"
                                                      [disabled]="isFieldDisabled" class="days-input form-control"
                                                      maxlength="150" />
                                                  </div>
                                                </div> 
                                                
                                                <div class="col-xs-12 col-xl-12 col-md-8">
                                                  <div class="form-group">
                                                      <label class="tags-label" for="tags">Tags</label>
                                                        <tag-input [addOnBlur]="true"
                                                          [(ngModel)]="selectedTags" 
                                                          [ngModelOptions]="{standalone: true}"
                                                            >
                                                            <tag-input-dropdown [autocompleteItems]="allTags"
                                                                [showDropdownIfEmpty]="true"
                                                                [dynamicUpdate]="true"></tag-input-dropdown>
                                                        </tag-input>
                                                  </div>
                                               </div>

                                               <!-- <div class="col-xs-12 col-xl-4 col-md-8">
                                                <div class="form-group d-flex justify-content-between">
                                                  <label class="abbr-label" for="abbreviation">Complition
                                                    Date</label>
                                                  <input type="date" class="form-control"                                                                                                       
                                                    [ngStyle]="isFieldDisabled ? { 'background-color': 'rgb(238 236 195)', 'color': '#11111', 'cursor': 'allowed' } : {}"                                                  
                                                    name="endDate_new" />
                                                </div>
                                              </div> -->
                                              </div>
                                              <div class="row mt-2 justify-content-center">
                                                <div class="col-xs-2">
                                                  <div class="btn btn-info d-flex justify-content-center" (click)="updatedTaskCheck(task.TASK_NO, selectedAssignTo)">Update
                                                  </div>
                                                </div>
                                                <div class="col-xs-2">
                                                  <div class="btn btn-light d-flex justify-content-center" (click)="toggleFormVisibility_main(task.TASK_NO.TASK_NO, task)">Cancel
                                                  </div>
                                                </div>                                                 
                                              </div>

                                            </div>
                                          </div>

                                        </form>
                                      </td>
                                    </tr>
                                    <ng-container *ngIf="task.visible && task.subtask && task.subtask.length > 0">
                                      <ng-container
                                        *ngTemplateOutlet="recursiveTaskTemplate; context: { $implicit: task.subtask }"></ng-container>
                                    </ng-container>
                                  </ng-container>
                                </tbody>

                              </table>
                            </div>

                          </div>
                        </div>
                  
                    </div>
                  </div>
                </div>
              </div>
            </form>

          </div>
        </div>
      </div>
    </div>
  </main>
</body>